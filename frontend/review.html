<!DOCTYPE html>
<html>
<head>
    <title>Review Timetable Options</title>
    <style>
        pre {
            background-color: #f0f0f0; 
            padding: 10px; 
            max-height: 300px;
            overflow: auto;
        }
        .option-box {
            border: 1px solid black; 
            margin: 10px; 
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>Review Timetable Options</h1>
    <button onclick="getTimetable()">Generate Timetable</button>
    <div id="options-container"></div>

    <h2>Approve Your Chosen Timetable</h2>
    <input type="number" min="1" max="3" id="choice" placeholder="Enter Option Number (1-3)" />
    <button onclick="approveTimetable()">Approve</button>

    <script>
        let timetableOptions = [];

        async function getTimetable() {
            try {
                const response = await fetch("http://127.0.0.1:5000/api/generate", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "classrooms": ["Room101", "Room102", "Lab1", "Lab2"],
                        "subjects": ["Math", "Physics", "Chemistry", "CS"],
                        "faculty": {
                            "Math": ["Dr. A"], 
                            "Physics": ["Dr. B"], 
                            "Chemistry": ["Dr. C"], 
                            "CS": ["Dr. D"]
                        },
                        "batches": ["BatchA", "BatchB"],
                        "max_classes_per_day": 3,
                        "faculty_leave": {
                            "Dr. B": ["Wednesday"]
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }

                const data = await response.json();
                timetableOptions = data.options;
                displayOptions(timetableOptions);
            } catch (error) {
                alert("Error fetching timetable: " + error.message);
            }
        }

        function displayOptions(options) {
            const container = document.getElementById('options-container');
            container.innerHTML = ""; // Clear previous options

            options.forEach((option, index) => {
                const div = document.createElement('div');
                div.className = "option-box";
                let content = `<h3>Timetable Option ${index + 1}</h3>`;
                for (const batch in option) {
                    content += `<h4>Batch: ${batch}</h4>`;
                    option[batch].forEach((dayClasses, dayIndex) => {
                        content += `<b>Day ${dayIndex + 1}:</b><br/>`;
                        dayClasses.forEach(cls => {
                            content += `Subject: ${cls.subject}, Faculty: ${cls.faculty}, Classroom: ${cls.classroom}<br/>`;
                        });
                        content += `<br/>`;
                    });
                }
                div.innerHTML = content;
                container.appendChild(div);
            });
        }

        function approveTimetable() {
            const choiceInput = document.getElementById('choice');
            const choice = parseInt(choiceInput.value);
            if (isNaN(choice) || choice < 1 || choice > timetableOptions.length) {
                alert("Please enter a valid option number between 1 and " + timetableOptions.length);
                return;
            }
            alert("You have approved timetable option #" + choice);
            // Here you can add code to send the approved choice to backend to save
        }
    </script>
</body>
</html>
