<!DOCTYPE html>
<html>
<head>
    <title>Review Timetable Options</title>
    <style>
        pre {
            background-color: #f0f0f0;
            padding: 10px;
            max-height: 300px;
            overflow: auto;
        }
        .option-box {
            border: 1px solid black;
            margin: 10px;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>Review Timetable Options</h1>
    <button onclick="getTimetable()">Generate Random Timetable</button>
    <button onclick="getGeneticTimetable()">Generate AI-Optimized Timetable</button>
    <div id="options-container"></div>

    <h2>Approve Your Chosen Timetable</h2>
    <input type="number" min="1" max="3" id="choice" placeholder="Enter Option Number (1-3)" />
    <button onclick="approveTimetable()">Approve</button>

    <script>
        let timetableOptions = [];

        async function fetchTimetable(url) {
            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        classrooms: [{name:"Room101", capacity:50},{name:"Lab1",capacity:30}],
                        subjects: ["Math", "Physics", "Chemistry", "CS"],
                        faculty: {
                            "Math": ["Dr. A"], "Physics": ["Dr. B"],
                            "Chemistry": ["Dr. C"], "CS": ["Dr. D"]
                        },
                        batches: ["BatchA", "BatchB"],
                        max_classes_per_day: 3,
                        faculty_leave: {"Dr. B": ["Wednesday"]},
                        total_classes: 20
                    })
                });
                if (!response.ok) throw new Error(response.statusText);
                const data = await response.json();
                timetableOptions = data.options;
                displayOptions(timetableOptions);
            } catch (err) {
                alert("Error fetching timetable: " + err);
            }
        }

        function getTimetable() {
            fetchTimetable("http://127.0.0.1:5000/api/generate");
        }

        function getGeneticTimetable() {
            fetchTimetable("http://127.0.0.1:5000/api/generate/genetic");
        }

        function displayOptions(options) {
            const container = document.getElementById('options-container');
            container.innerHTML = "";
            options.forEach((option, idx) => {
                const div = document.createElement("div");
                div.className = "option-box";
                let content = `<h3>Timetable Option ${idx + 1}</h3>`;
                for (let batch in option) {
                    content += `<h4>Batch: ${batch}</h4>`;
                    option[batch].forEach((dayClasses, dayIdx) => {
                        content += `<b>Day ${dayIdx + 1}:</b><br/>`;
                        dayClasses.forEach(cls => {
                            content += `Subject: ${cls.subject}, Faculty: ${cls.faculty}, Classroom: ${cls.classroom}<br/>`;
                        });
                        content += "<br/>";
                    });
                }
                div.innerHTML = content;
                container.appendChild(div);
            });
        }

        async function approveTimetable() {
            const choiceInput = document.getElementById("choice");
            const choice = parseInt(choiceInput.value);
            if (isNaN(choice) || choice < 1 || choice > timetableOptions.length) {
                alert("Please enter a valid option number");
                return;
            }
            try {
                const response = await fetch("http://127.0.0.1:5000/api/approve", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        approved_option: choice,
                        timetable: timetableOptions[choice - 1]
                    })
                });
                const result = await response.json();
                alert(result.message);
            } catch (e) {
                alert("Approval failed: " + e.message);
            }
        }
    </script>
</body>
</html>
